üîé How It Should Flow (based on your schema)

Fund Allocation (fundAllocations table)

Records the movement: projectId, toUserId (team leader), amount, category.

Transactions (transactions table)

Usually, a corresponding transaction is logged (type = allocation).

Projects (projects table)

budget and/or consumedAmount should update, either:

Automatically via a trigger, or

In your storage.ts logic after a fund allocation is created.

Frontend ‚Äì Projects Module

Fetches /api/projects or /api/projects/:id and expects the budget + consumedAmount fields to already reflect allocations.

‚ö†Ô∏è Why Your Project Module Isn‚Äôt Updating

One of these gaps is likely the cause:

No link between fundAllocations and projects

The allocation record exists, but the project‚Äôs budget isn‚Äôt being recalculated.

Unless you explicitly call an update in your API after allocation, the numbers stay static.

Transactions not being logged

If the /api/fund-allocations POST doesn‚Äôt also create a transactions row, the analytics/Projects view won‚Äôt see the spend.

Frontend fetching raw projects only

/api/projects might just return the static project row.

If your backend hasn‚Äôt updated budget/consumedAmount, the UI won‚Äôt show the change.

RLS/Tenant filtering

If the allocation saved with the wrong tenantId, the Projects query (scoped by tenant) won‚Äôt see it.

‚úÖ How to Fix

Backend adjustment (most likely needed):
In your POST /api/fund-allocations route:

Insert into fundAllocations.

Insert a matching transaction (type = allocation).

Update the projects table ‚Üí increment budget or consumedAmount.

Alternative (cleaner design):
Leave projects table as static, and compute budget dynamically when querying:

SELECT p.id, p.title, SUM(f.amount) as allocatedBudget
FROM projects p
LEFT JOIN fundAllocations f ON p.id = f.projectId
WHERE p.tenantId = $1
GROUP BY p.id;


Then your frontend always sees the latest state.

üß™ Quick Test You Can Run

After fund allocation, hit /api/fund-allocations ‚Üí confirm record exists.

Hit /api/transactions ‚Üí see if a matching record exists.

Hit /api/projects/:id ‚Üí check if budget or consumedAmount updated.

If allocations exist but projects didn‚Äôt change, the backend isn‚Äôt syncing them.